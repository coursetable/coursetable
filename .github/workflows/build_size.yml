name: Build Performance

on:
  pull_request:
    branches:
      - master
    paths:
      - frontend/**

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  build-size:
    name: Build size report
    timeout-minutes: 30
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Use Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
      - name: Install Dependencies
        run: bun install --frozen-lockfile
      - name: Build frontend for build size report
        run: |
          cd frontend
          bun run clean
          bun run build
          echo "âœ… Build completed successfully!"
          echo "Total build size: $(du -sh build | cut -f1)"
          echo ""
          echo "Asset sizes:"
          find build/assets -name "*.js" -o -name "*.css" | sort | while read file; do
            size=$(ls -lh "$file" | awk '{print $5}')
            name=$(basename "$file")
            echo "  $name: $size"
          done
