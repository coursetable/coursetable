version: '3'
services:
  api:
    restart: always
    ports:
      - '${INSECURE_PORT:-8039}:${INSECURE_PORT:-8039}'
    volumes:
      - ./src:/usr/src/app/api/src
    environment:
      NODE_ENV: production
      HOT_RELOAD: 'false'
    labels:
      traefik.enable: true
      traefik.http.routers.coursetable.rule: Host(`api.coursetable.com`)
      traefik.http.routers.coursetable.tls: true
      traefik.http.routers.coursetable.tls.certResolver: ctresolver
      traefik.http.routers.coursetable.middlewares: gzip-compress@file
    networks:
      - traefik
      - mysql
      - api

  graphql-engine:
    restart: always
    networks:
      - ferry
      - api

  redis:
    restart: always

networks:
  traefik:
    external: true
  ferry:
    external: true
  mysql:
    external: true
