services:
  api:
    build:
      context: ../../
      dockerfile: ./api/Dockerfile
    image: coursetable/api:latest
    container_name: ${EXPRESS_HOST?EXPRESS_HOST}
    ports:
      - ${API_PORT?API_PORT}:${API_PORT?API_PORT}
    environment:
      API_PORT: ${API_PORT?API_PORT}
      CANNY_KEY: ${CANNY_KEY?CANNY_KEY}
      CHALLENGE_PASSWORD: ${CHALLENGE_PASSWORD?CHALLENGE_PASSWORD}
      DB_URL: postgresql://${DB_USER?DB_USER}:${DB_ROOT_PASSWORD?DB_ROOT_PASSWORD}@${DB_HOST?DB_HOST}:${DB_PORT?DB_PORT}/${DB_NAME?DB_NAME}
      FERRY_RELOAD_SECRET: ${FERRY_RELOAD_SECRET?FERRY_RELOAD_SECRET}
      FRONTEND_ENDPOINT: ${FRONTEND_ENDPOINT?FRONTEND_ENDPOINT}
      GRAPHQL_ENDPOINT: http://${GRAPHQL_ENGINE_HOST?GRAPHQL_ENGINE_HOST}:8080/v1/graphql
      HASURA_GRAPHQL_ADMIN_SECRET: ${HASURA_GRAPHQL_ADMIN_SECRET?HASURA_GRAPHQL_ADMIN_SECRET}
      REDIS_HOST: ${REDIS_HOST?REDIS_HOST}
      SENTRY_DSN: ${SENTRY_DSN?SENTRY_DSN}
      SENTRY_ENVIRONMENT: ${SENTRY_ENVIRONMENT?SENTRY_ENVIRONMENT}
      SESSION_SECRET: ${SESSION_SECRET?SESSION_SECRET}
      YALIES_API_KEY: ${YALIES_API_KEY?YALIES_API_KEY}
    networks:
      - api

networks:
  api:
    name: ${API_NETWORK?API_NETWORK}
    driver: bridge
